<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro-Actions - Portrait Intelligence Labâ„¢</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
   <div id="header-placeholder"></div>


    <div class="container">
        <div class="micro-actions-panel">
            <h2>Micro-Actions Checklist</h2>
            <p style="color: var(--text-light); margin-bottom: 2rem;">
                Complete all 7 micro-actions to unlock the $49 resource. Each action is designed to build momentum and create real progress.
            </p>

            <div class="progress-container">
                <div class="progress-label">
                    <span>Overall Progress</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-bar" style="width: 0%;"></div>
                </div>
            </div>

            <ul class="checklist" id="micro-actions-list">
                <li class="checklist-item">
                    <input type="checkbox" id="action-0" data-index="0">
                    <label for="action-0">Complete your profile setup</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
                <li class="checklist-item">
                    <input type="checkbox" id="action-1" data-index="1">
                    <label for="action-1">Read the welcome guide</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
                <li class="checklist-item">
                    <input type="checkbox" id="action-2" data-index="2">
                    <label for="action-2">Set your learning goals</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
                <li class="checklist-item">
                    <input type="checkbox" id="action-3" data-index="3">
                    <label for="action-3">Complete your first assessment</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
                <li class="checklist-item">
                    <input type="checkbox" id="action-4" data-index="4">
                    <label for="action-4">Join the community discussion</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
                <li class="checklist-item">
                    <input type="checkbox" id="action-5" data-index="5">
                    <label for="action-5">Share your progress</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
                <li class="checklist-item">
                    <input type="checkbox" id="action-6" data-index="6">
                    <label for="action-6">Review your learning path</label>
                    <span class="check-icon hidden">âœ“</span>
                </li>
            </ul>

            <div id="completion-message" class="hidden">
                <div class="success-message">
                    <div class="success-icon">ðŸŽ‰</div>
                    <h2>Congratulations!</h2>
                    <p style="font-size: 1.125rem; margin-top: 1rem;">
                        You've completed all micro-actions! The $49 resource has been unlocked.
                    </p>
                    <a href="/dashboard" class="btn btn-success btn-large mt-3">View Dashboard</a>
                </div>
            </div>
        </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/supabase.js"></script>
<script src="/js/layout.js"></script>
<script src="/js/header-auth.js"></script>
    <script src="/js/main.js"></script>

    <script src="/js/app.js"></script>
 <script>
/* =========================
   CONSTANTS
========================= */
const TOTAL_ACTIONS = 7;
const GUEST_KEY = "guest_micro_actions";

/* =========================
   LOAD MICRO ACTIONS
========================= */
async function loadMicroActions() {
  const { data: { user } } = await supabase.auth.getUser();

  let actions = Array(TOTAL_ACTIONS).fill(false);

  /* =========================
     ðŸ‘¥ GUEST USER
  ========================== */
  if (!user) {
    const saved = localStorage.getItem(GUEST_KEY);
    if (saved) actions = JSON.parse(saved);

    initCheckboxes(actions, null);
    updateProgress(actions);
    return;
  }

  /* =========================
     ðŸ‘¤ LOGGED-IN USER
  ========================== */
  const { data: profile, error } = await supabase
    .from("profiles")
    .select("micro_actions")
    .eq("id", user.id)
    .single();

  if (error) {
    console.error("Load error:", error);
    return;
  }

  actions = profile.micro_actions || actions;

  initCheckboxes(actions, user.id);
  updateProgress(actions, user.id);
}

/* =========================
   INIT CHECKBOXES
========================= */
function initCheckboxes(actions, userId) {
  actions.forEach((completed, index) => {
    const checkbox = document.getElementById(`action-${index}`);
    const item = checkbox.closest(".checklist-item");
    const icon = item.querySelector(".check-icon");

    checkbox.checked = completed;
    icon.classList.toggle("hidden", !completed);

    checkbox.onchange = async () => {
      actions[index] = checkbox.checked;
      icon.classList.toggle("hidden", !checkbox.checked);

      updateProgress(actions, userId);

      /* ðŸ‘¥ GUEST â†’ localStorage */
      if (!userId) {
        localStorage.setItem(GUEST_KEY, JSON.stringify(actions));
        return;
      }

    
      const progress = Math.round(
        (actions.filter(Boolean).length / actions.length) * 100
      );

      await supabase
        .from("profiles")
        .update({
          micro_actions: actions,
          micro_progress: progress
        })
        .eq("id", userId);
    };
  });
}


function updateProgress(actions, userId = null) {
  const completed = actions.filter(Boolean).length;
  const progress = Math.round((completed / actions.length) * 100);

  document.getElementById("progress-text").textContent = `${progress}%`;
  document.getElementById("progress-bar").style.width = `${progress}%`;
}



document.addEventListener("DOMContentLoaded", loadMicroActions);
</script>



 <div id="footer-placeholder"></div>


</body>
</html>