<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Confirmed - Portrait Intelligence Lab™</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="payment-hero" style="margin-bottom: 0;">
        <div class="container">
            <div class="success-icon" style="font-size: 5rem; margin-bottom: 1rem;">✓</div>
            <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Payment Successful!</h1>
            <p style="font-size: 1.25rem; opacity: 0.95;" id="confirmation-details">
                Your payment has been processed successfully.
            </p>
        </div>
    </div>

    <div class="container">
<div class="card payment-card payment-confirm">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--dark);">Payment Details</h2>
            </div>
            
            <div style="background: var(--light); padding: 2rem; border-radius: 0.75rem; margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--border);">
                    <span style="color: var(--text-light); font-weight: 500;">Tier:</span>
                    <span style="font-weight: 700; font-size: 1.125rem; color: var(--dark);" id="tier-name"></span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--border);">
                    <span style="color: var(--text-light); font-weight: 500;">Payment ID:</span>
<span
  id="payment-id"
  style="
    font-weight: 600;
    font-family: monospace;
    font-size: 0.95rem;
    color: var(--dark);
    max-width: 260px;
    text-align: right;
    word-break: break-all;
    overflow-wrap: anywhere;
    display: inline-block;
  "
></span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0;">
                    <span style="color: var(--text-light); font-weight: 500;">Payment Method:</span>
                    <span style="font-weight: 700; color: var(--primary);" id="payment-method"></span>
                </div>
            </div>

            <div style="background: #d1fae5; padding: 1.5rem; border-radius: 0.5rem; border-left: 4px solid var(--success); margin-bottom: 2rem;">
                <p style="color: #065f46; font-weight: 600; margin: 0;">
                    ✅ Your tier has been unlocked! You now have access to all tier benefits.
                </p>
            </div>

            <div class="action-group-mobile">
                <a href="/dashboard" class="btn btn-primary btn-large">Go to Dashboard</a>
                <a href="/" class="btn btn-secondary btn-large">Back to Home</a>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
<script>
(async () => {
    // 1. Wait for Supabase Auth to load
    const { data: { user    } } = await supabase.auth.getUser();
    if (!user) return;

    console.log("Payment confirmed for user:", user.id);

    // 2. Call the refresh endpoint to update the JWT Cookie
    const res = await fetch("/api/refresh-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: user.id })
    });

    const data = await res.json();
    if (data.success) {
        console.log("Session refreshed, redirecting...");
        window.location.href = "/dashboard";
    } else {
        console.error("Refresh failed:", data.error);
    }
})();
</script>

    <script>
  // Get details from URL
  const urlParams = new URLSearchParams(window.location.search);
  const tier = urlParams.get('tier');
  const paymentId = urlParams.get('session_id'); // ✅ FIXED
  const method = 'Stripe';

  const tierMap = {
    '9.99': 'Starter Tier ($9.99)',
    '19.99': 'Professional Tier ($19.99)',
    '199': 'Access Pass ($199)',
    '999': 'Elite Challenge ($999)',
    '9999': 'The Circle ($9,999)'
  };

  if (tier && tierMap[tier]) {
    document.getElementById('tier-name').textContent = tierMap[tier];
    document.getElementById('confirmation-details').textContent =
      `Your ${tierMap[tier]} has been unlocked! You now have access to all tier benefits.`;
  }

  document.getElementById('payment-id').textContent =
    paymentId || 'N/A';

  document.getElementById('payment-method').textContent = method;
</script>

 <div id="footer-placeholder"></div>

<script src="/js/layout.js"></script>
<script src="/js/header-auth.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>