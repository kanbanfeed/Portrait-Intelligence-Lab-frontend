<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$9.99 Tier - Portrait Intelligence Lab‚Ñ¢</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="container">
        <div class="tier-hero">
            <h1>Starter Tier</h1>
            <div class="tier-price">$9.99</div>
            <p>Unlock additional resources and accelerate your growth</p>
        </div>

        <div class="tier-content">
            <div class="card">
                <h2 style="font-size: 2rem; margin-bottom: 1rem; color: var(--dark);">About This Tier</h2>
                <p class="tier-description">
                    The Starter Tier builds on the foundation of the Free Tier, providing you with premium content and resources to accelerate your learning journey. This tier is perfect for those ready to invest in their growth and access structured content designed for serious learners.
                </p>
                <p class="tier-description">
                    Gain access to our premium content library, priority support, and exclusive resources that will help you progress faster and more effectively.
                </p>
            </div>

            <div class="what-you-get">
                <h2>What You Get</h2>
                <ul class="features-list">
                    <li>Everything in Free Tier</li>
                    <li>Premium content library access</li>
                    <li>Priority customer support</li>
                    <li>Advanced progress analytics</li>
                    <li>Exclusive starter resources</li>
                    <li>Early access to new features</li>
                    <li>Monthly progress reports</li>
                </ul>
            </div>

            <div class="unlock-section">
                <h2>Unlock This Tier</h2>
                <p style="font-size: 1.125rem; color: var(--text-light); margin-bottom: 2rem;">
                    One-time payment of $9.99. No recurring charges.
                </p>
                <div class="tier-actions">
   <a
            id="purchase-btn"
            class="btn btn-success btn-large">
            Join This Tier
                </a>

                    <a href="/dashboard" class="btn btn-secondary btn-large">View Dashboard</a>
                <a href="/#tiers" class="btn btn-primary btn-large"> Explore Other Tiers</a>

                </div>


            </div>
        </div>
    </div>
 <div id="footer-placeholder"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/supabase.js"></script>

<script src="/js/layout.js"></script>
<script src="/js/header-auth.js"></script>
<script src="/js/main.js"></script>


<script>
document.addEventListener("DOMContentLoaded", async () => {
  const btn = document.getElementById("purchase-btn");
  if (!btn) return;

  const TIER_CODE = "9.99"; // üîÅ Change per tier page

  try {
    /* ======================
        GET LOGGED-IN USER
    ====================== */
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    /* ======================
        NOT LOGGED IN
    ====================== */
    if (!user || authError) {
      btn.textContent = "Login & Join";
      btn.onclick = () => {
        window.location.href = "/auth/login.html";
      };
      return;
    }

    /* ======================
        FETCH USER PROFILE
    ====================== */
    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("tier")
      .eq("id", user.id)
      .single();

    if (profileError) {
      console.error("‚ùå Profile fetch error:", profileError);
      btn.textContent = "Error loading profile";
      btn.disabled = true;
      return;
    }

    /* ======================
        CHECK EXISTING TIERS
    ====================== */
    const userTiers = Array.isArray(profile.tier)
      ? profile.tier
      : [profile.tier || "free"];

    if (userTiers.includes(TIER_CODE)) {
      btn.textContent = "Already Purchased";
      btn.disabled = true;
      btn.classList.remove("btn-success");
      btn.classList.add("btn-secondary");
      btn.style.opacity = "0.7";
      btn.style.cursor = "not-allowed";
      return;
    }

    /* ======================
        PURCHASE HANDLER
    ====================== */
    btn.onclick = async () => {
      btn.disabled = true;
      btn.textContent = "Redirecting‚Ä¶";

      try {
        const res = await fetch(
          "https://portrait-intelligence-lab-backend.onrender.com/api/stripe/create-checkout",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              tier: TIER_CODE,
              supabaseUserId: user.id
            })
          }
        );

        if (!res.ok) {
          throw new Error("Checkout request failed");
        }

        const data = await res.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error("No checkout URL returned");
        }

      } catch (err) {
        console.error("‚ùå Checkout error:", err);
        btn.textContent = "Try Again";
        btn.disabled = false;
      }
    };

  } catch (err) {
    console.error("‚ùå Unexpected error:", err);
    btn.textContent = "Error";
    btn.disabled = true;
  }
});
</script>



</body>
</html>