<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Circle - Portrait Intelligence Lab‚Ñ¢</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="header-placeholder"></div>

    <div class="container">
        <div class="tier-hero" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">
            <h1>The Circle</h1>
            <div class="tier-price">$9,999</div>
            <p>Exclusive membership for the elite</p>
        </div>

        <div class="tier-content">
            <div class="card">
                <h2 style="font-size: 2rem; margin-bottom: 1rem; color: var(--dark);">About The Circle</h2>
                <p class="tier-description">
                    The Circle is the most exclusive tier in Portrait Intelligence Lab‚Ñ¢. Reserved for those who are ready to join an elite community of top performers, innovators, and leaders. This is not just a membership‚Äîit's an invitation to join a select group that shapes the future.
                </p>
                <p class="tier-description">
                    Members of The Circle gain access to exclusive pods, lifetime membership, and resources that are available nowhere else. This tier is by invitation or direct purchase for those who understand the value of elite-level access.
                </p>
            </div>

            <div class="what-you-get">
                <h2>What You Get</h2>
                <ul class="features-list">
                    <li>Everything in Elite Challenge</li>
                    <li>Exclusive Circle Pod access</li>
                    <li>Lifetime membership</li>
                    <li>Direct access to founders</li>
                    <li>Exclusive Circle events</li>
                    <li>Private mentorship network</li>
                    <li>Co-creation opportunities</li>
                </ul>
            </div>

            <div class="unlock-section">
                <h2>Join The Circle</h2>
                <p style="font-size: 1.125rem; color: var(--text-light); margin-bottom: 2rem;">
                    One-time payment of $9,999. Lifetime access to The Circle.
                </p>
            <div class="tier-actions">

           <a
  id="purchase-btn"
  class="btn btn-success btn-large">
  Join This Tier
            </a>



                <a href="/dashboard" class="btn btn-secondary btn-large" >View Dashboard</a>
                <a href="/#tiers" class="btn btn-primary btn-large"> Explore Other Tiers</a>

            </div>

            </div>
        </div>
    </div>
 <div id="footer-placeholder"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/supabase.js"></script>

<script src="/js/layout.js"></script>
<script src="/js/header-auth.js"></script>
<script src="/js/main.js"></script>

<!-- then your purchase script -->

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const btn = document.getElementById("purchase-btn");
  if (!btn) return;

  const TIER_CODE = "9999"; // üîÅ Change per tier page

  try {
    /* ======================
        GET LOGGED-IN USER
    ====================== */
    const { data: { user }, error: authError } = await supabase.auth.getUser();

    /* ======================
        NOT LOGGED IN
    ====================== */
    if (!user || authError) {
      btn.textContent = "Login & Join";
      btn.onclick = () => {
        window.location.href = "/auth/login.html";
      };
      return;
    }

    /* ======================
        FETCH USER PROFILE
    ====================== */
    const { data: profile, error: profileError } = await supabase
      .from("profiles")
      .select("tier")
      .eq("id", user.id)
      .single();

    if (profileError) {
      console.error("‚ùå Profile fetch error:", profileError);
      btn.textContent = "Error loading profile";
      btn.disabled = true;
      return;
    }

    /* ======================
        CHECK EXISTING TIERS
    ====================== */
    const userTiers = Array.isArray(profile.tier)
      ? profile.tier
      : [profile.tier || "free"];

    if (userTiers.includes(TIER_CODE)) {
      btn.textContent = "Already Purchased";
      btn.disabled = true;
      btn.classList.remove("btn-success");
      btn.classList.add("btn-secondary");
      btn.style.opacity = "0.7";
      btn.style.cursor = "not-allowed";
      return;
    }

    /* ======================
        PURCHASE HANDLER
    ====================== */
    btn.onclick = async () => {
      btn.disabled = true;
      btn.textContent = "Redirecting‚Ä¶";

      try {
        const res = await fetch(
          "https://portrait-intelligence-lab-backend.onrender.com/api/stripe/create-checkout",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              tier: TIER_CODE,
              supabaseUserId: user.id
            })
          }
        );

        if (!res.ok) {
          throw new Error("Checkout request failed");
        }

        const data = await res.json();

        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error("No checkout URL returned");
        }

      } catch (err) {
        console.error("‚ùå Checkout error:", err);
        btn.textContent = "Try Again";
        btn.disabled = false;
      }
    };

  } catch (err) {
    console.error("‚ùå Unexpected error:", err);
    btn.textContent = "Error";
    btn.disabled = true;
  }
});
</script>





</body>
</html>